{% extends 'pos_app/base.html' %}

{% load static %}

{% block title %}{{ category_name }}{% endblock %}

{% block body_block %}

        <!-- Modal for sales messages -->
        <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h4 class="modal-title" id="myModalLabel">Please Wait</h4>
              </div>
              <div class="modal-body center-block">
                          <div id="sales_form_messages">
                          </div>
                <div class="progress">
                  <div class="progress-bar bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">

                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal for messages-->

        <div class="row">
          <div class="col-lg-12">
            <h3>Sales Dashboard<!--<small>Enter New User</small>--></h3>
            <div class="col-lg-7">
                <ol class="breadcrumb">
                  <li><a href="index.html"><i class="fa fa-dashboard"></i>Products</a></li>
                  <li class="active"><i class="fa fa-edit"></i> Add New Products Form</li>
                </ol>
            </div>

            <div class="col-lg-5">

                <div class="breadcrumb">
                    <small>Product Search</small>
                      <div class="form-group input-group">
                        {% csrf_token %}
                        <input type="text" class="form-control" id="search" name="search" placeholder="Enter the product you want to search here" autocomplete="off">
                        <span class="input-group-btn">
                          <button class="btn btn-default" type="button"><i class="fa fa-search"></i></button>
                        </span>
                      </div>
                </div>

            </div>
          </div><!-- /col-lg-12 -->
        </div><!-- /.row -->

        <div class="row">
        <div class="col-lg-12">
              <div class="col-lg-7">

                 <div class="panel panel-success" id="sales-transaction">
                      <div class="panel-heading"><!--Start panel heading-->
                        <h3 class="panel-title">New Sale</h3>
                          <ul class="list-group">
                          <li class="list-group-item">
                              <span class="badge" id="transaction-no">{{ transaction_no }}</span>
                              <!--<input id="transaction-no-dup" value="{{ transaction_no }}" type="text" name="transaction-no-dup">-->
                              Transaction Number:
                          </li>
                          </ul>
                      </div>                    <!--End panel heading-->

                     <!--contains the hidden inputs for all the totals and the list of the items in the current sale-->
                      <div class="panel-body" id="hidden-appends">  <!--Start panel body-->

                          <!--<input id="subtotal_totals" value="" name ="subtotal_totals" type="text">
                          <input id="tax_amount_totals" value="" name = "tax_amount_totals" type="text">
                          <input id="net_total_totals" value="" name = "net_total_totals" type="text">-->

                          <div class="bs-example"> <!--Start bs-example-->
                            <ul class="list-group">
                              <li class="list-group-item">
                                <span class="badge">Subtotal</span>
                                Item Name
                              </li>
                            </ul>
                            <!--saleslist contains the list of items in this current sale-->
                            <div class="list-group" id="sales-list"> <!--Start list-group-->

                            </div>                <!--End list-group-->
                          </div>                  <!--End bs-example-->

                          <ul class="nav nav-pills"> <!--End nav-pills-->
                            <li class="active"><a href="javascript:void(0);">Total Amt<span class="badge" id="sum_subtotal_span"></span></a></li>
                            <li class="active"><a href="javascript:void(0);">Net Amt<span class="badge" id="sum_nettotal_span"></span></a></li>
                            <li class="active"><a href="javascript:void(0);">Tax Amt<span class="badge" id="sum_taxtotal_span"></span></a></li>
                          </ul>                      <!--End nav-pills-->
                          <!--form to post total sales data -->
                          <form role="form" id="sales_form">

                                  {% csrf_token %}

                                  {{ salesform.as_p }}

                          </form>

                      </div>                    <!--End panel body--->
                     <div class="panel-footer">
                            <button type="button" class="btn btn-warning btn-lg" id="complete-sale" href="#myModal2" data-toggle="modal">Complete Sale</button>
                     </div>
                 </div>
                 <!--end of the panel for the list of products put to be sold-->

              </div>    <!--end clo-lg-6-->

              <div class="col-lg-5">
                  <div class="panel panel-primary">

                      <div class="panel-heading">
                        <h3 class="panel-title"><i class="fa fa-clock-o"></i>Search Results</h3>
                      </div>

                      <div class="panel-body">

                        <div class="bs-example">
                          <div class="list-group" id="search-results">

                          </div>
                        </div>
                      </div>

                      <div class="text-right">
                      </div>

                  </div><!--end panel primary-->
              </div><!--end clo-lg-6-->
        </div> <!--end clo-lg-12-->
        </div><!-- /.row -->

        <!-- modal with the product details -->
        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog" id="search-results2">

          </div>
        </div>
        <!--end of modal with product details and enter quantity-->

        <div class="row">
        <div class="col-lg-12">
              <div class="panel panel-primary">

                  <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-clock-o"></i>Sales Reports</h3>
                  </div>

                  <div class="panel-body">
                      <div class="bs-example col-lg-2">
                      <ul class="breadcrumb col">
                        <li class="active">Sale</li>
                      </ul>
                      </div>
                      <div class="bs-example col-lg-4">
                          <ul class="breadcrumb">
                            <li class="active">Sale Summarry</li>
                          </ul>
                      </div>
                      <div class="bs-example col-lg-6">
                          <ul class="breadcrumb">
                            <li class="active">Sales Details</li>
                            <li class="active">Product Sold in this Transaction</li>
                          </ul>
                      </div>
                    <div class="bs-example col-lg-12"  id="sales-results">

                    </div>
                  </div>

                  <div class="text-right">

                  </div>

              </div><!--end panel primary-->

        </div> <!--end clo-lg-12-->
        </div><!-- /.row -->

<!--for ajax-->
<!--<script src="{% static "js/jquery.min.js" %}"></script>-->

<script>
  $.ajax({ // create an AJAX call...
      type: 'GET', // GET or POST
      url: '/pos_app/sales_results/', // the file to call
      success: function(response) { // on success..
        $('#sales-results').html(response); // update the DIV
      },
      error: function(response){
        $('#sales-results').html(response); // update the DIV
      }
  });
</script>

<script type="text/javascript">
//on searching a product
$(function() {
$('#search').keyup(function() {
    var query;
    query = $(this).val();

    $.ajax({
        type: "GET",
        url: "/pos_app/suggest_product/",
        data: {
            'search_text' : query,
            'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val()
        },
        success: function (data)
            {
                $('#search-results').html(data);
            }
        //dataType: 'html'
    });
});
});
</script>

<!--this is for the sales form submission ajax call -->
<script>
$("#complete-sale").click(function(event) // catch the form's submit//button click
{
  $.ajax({ // create an AJAX call...
      data: $('#sales_form').serialize(), // get the form data
      type: 'POST', // GET or POST
      url: '/pos_app/complete_sale/', // the file to call
      success: function(response) { // on success..
        $('#sales_form_messages').html(response); // update the DIV
      },
      error: function(response){
        $('#sales_form_messages').html(response); // update the DIV
      }
  });
  //return false;
});
</script>


{% endblock %}